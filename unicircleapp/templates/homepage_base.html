{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Dashboard{% endblock %}</title>


  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'posts_area.css' %}" />

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");
    const suggestionsBox = document.getElementById("searchSuggestions");

    searchInput.addEventListener("keyup", function () {
        let query = searchInput.value.trim();
        if (query.length > 0) {
            fetch(`/live-search/?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    suggestionsBox.innerHTML = "";
                    if (data.length > 0) {
                        data.forEach(item => {
                            let option = document.createElement("a");
                            option.classList.add("dropdown-item", "d-flex", "align-items-center");

                            option.href = `/${item.username}/`; // adjust profile URL

                            option.innerHTML = `
                                <img src="${item.profile_picture}" alt="pic" 
                                     class="rounded-circle me-2" 
                                     style="width:35px; height:35px; object-fit:cover;">
                                <div class="d-flex flex-column">
                                    <span>${item.username}</span>
                                    <small class="text-muted">${item.user_type}</small>
                                </div>
                            `;
                            suggestionsBox.appendChild(option);
                        });
                        suggestionsBox.style.display = "block";
                    } else {
                        suggestionsBox.style.display = "none";
                    }
                });
        } else {
            suggestionsBox.style.display = "none";
        }
    });

    // Hide when clicking outside
    document.addEventListener("click", function (e) {
        if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
            suggestionsBox.style.display = "none";
        }
    });
});

</script>


<body class="bg-light">
    {% if user.profile and user.is_approved %}
    {% include 'logged_in_navbar.html' %}
  {% else %}
    <div class="alert alert-warning text-center m-4">
      You are currently not approved!  
      <a href="{% url 'unicircleapp:logoutpage' %}" class="btn btn-sm btn-danger ms-2">Logout</a>
    </div>
  {% endif %}

  <div class="main" style="display: flex; justify-content: center;">
   {% block content %}
    {% endblock %}
  </div>
</body>

</html>